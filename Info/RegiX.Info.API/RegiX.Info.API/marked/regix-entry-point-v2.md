


# Описание на входна точка v2 (RegiXEntryPointV2.svc)
Услугата [RegiXEntryPointV2.svc](https://service-regix.egov.bg/RegiXEntryPointV2.svc) представлява актуалният начин за консумация на присъединени към RegiX операции на адаптер. Услугата описва следните четири операции:
 - Execute
 - CheckResult
 - AcknowledgeResultReceived
 - ExecuteCallback

## Execute
Изпълнява операция за извикване на услуга към присъединен към RegiX адаптер. 

### Аргумент (ServiceRequestData)
Входен аргумент на операцията съдържащ еднаква структура за извършване на обръщение към присъединена операция на регистър към RegiX.

|Име||Стойност|Описание|
|:-------|:-------|:-------|:--------|
|RequestProcessing||Verify \| Decrypt \| TransformFromPDF \| Asynchronous |Представлява инструкции към адаптера за начина на обработка на подадения аргумент. Към момента не съществува адапетр използващ тази функционалност и този аргумент трябва да бъде подаван с празна стойност или изобщо да не бъде подаван. Принципната идея е да се позволи подаването на аргументи, които не са XML структурирани и тяхнта последващата обработка да се определя от данните в този аргумент.|
|ResponseProcessing||Encrypt \| TransformToPDF|Представлява инструкции към адаптера за начина на обработка на връщания резултат. Към момента е реализирана опцищята _TransformToPDF_, която преобразува резултатния XML документ в PDF. Все още не всички адаптери са обновени и поддържат тази функционалност.|
|Operation||String|Техническото име на услугата. За всяка операция техническото име е изписано под говорящото име на сайта [https://info-regix.egov.bg](https://info-regix.egov.bg)|
|Argument||XML|XML на аргумента|
|EIDToken||String |Параметър приложим при достъп на RegiX през шината и използване на еАвт. Представлява token получен от eАвт. Към момента всички обръщения се извършват директно към RegiX и този параметър не би трябвало да се подава.|
|CallContext|||Контекст на извикването|
| | ServiceURI| String |Идентификатор на инстанцията на административната услуга или процедура в администрацията (например: номер на преписка)|
| | ServiceType| String |Вид на услугата, във връзка с която се извиква операцията:<br/> -  За административна услуга: типа на услугата;<br/> -  За проверовъчна дейност: вида на дейността;<br/> - За друга причина за използване: описание на причината;|
| | EmployeeIdentifier| String |Идентификатор на служител на администрацията. Например:<br/> -  EMAIL адрес, с който служителя влиза в АД на съответната администрация (или с който фигурира в ЕИСУЧРДА).<br/>  -  Потребителско име в информационната система - клиент. Идентификатора трябва да е проверен от информационната система - клиент|
| | EmployeeNames| String |Имена на служител на администрацията, иментата на служителя, чийто индентификатор е подаден в EmployeeIdentifier|
| | EmployeeAditionalIdentifier| String |Опционален допълнителен идентификатор на служител от администрация – например номер на служебната карта или друг индентификатор от информационната система - клиент|
| | EmployeePosition| String |Длъжност или позиция на служителя в администрацията|
| | ResponsiblePersonIdentifier| String |Опционален идентификатор на човека отговорен за справката. Тук трябва да се слага стойност, когато заявките не се инициират ръчно от конкретен служител, а се генерират автоматично от информационна система. Това може да бъде ръководител на звено в Администрацията, ползваща съответната справка в информационната система-клиент.|
| | LawReason| String |Контекст на правното основание. Правното основание може да произтича директно от нормативната уредба или да бъде базирано на сключено споразумение. Тук се описва правно основание или се цитира регистрирано такова.|
| | Remark| String |Допълнително поле в свободен текст|
| | AdministrationOId| |String Идентификационен код на администрация (oID от eAuth)|
| | AdministrationName| String |Наименование на администрацията, ползваща системата|
|CallbackURL||String (URI)|Адрес за връщане на резултат от асинхронна услуга. В случай, че консуматорът желае да получава резултата на адрес посочен от него. Услугата разположена на този адрес трябва да отговаря на спецификацията на операцията ExecuteCallback според wsdl-а на https://service-regix.egov.bg/RegiXEntryPointV2.svc услугата. Незадължително|
|EmployeeEGN||String|ЕГН на служителя извършващо услугата. Незадължително|
|CitizenEGN||String|ЕГН на лицето, за което се извършва услугата. Незадължително|
|SignResult||Boolean|Дали върнатия резлутат да бъде подписан|
|ReturnAccessMatrix||Boolean|Дали върнатия резултат да съдържа приложената матрица за достъп|

### Резултат (ServiceResultData)
Резултат от изпълнението на операцията. Може да съдържа изготвения резултат, информация за възникнало изключение или в случай на асинхронен адаптер информация за започнала обработка.

|Име||Стойност|Описание|
|:-------|:-------|:-------|:--------|
|IsReady||Boolean|Дали резултатът е готов|
|Data|||Опаковащ елемент на резултата|
||Request| XML |Входен аргуент|
||Response| XML | Резултатни данни|
||Matrix| XML | Приложена матрица за достъп за извикването, ако такава е поискана|
|Signature|| XML |Криптографски подпис на Data елемента|
|HasError||Boolean|Дали е възникнала грешка|
|Error||String|Грешка, ако такава е възникнала|
|ServiceCallID||Number|Идентификатор на извикването в RegiX|
|VerificationCode||String|Код за потвърждение. Връща се в случай, че резултатът не е готов и адаптера обработва услугата асинхронно.|

## CheckResult
Промерка за резултат от изпълнение на асинхронна услуга. Тази операция е необходимо да бъде извикана в случай, когато адаптерът е асинхронен и при изпълнение на операция Execute е върнат резултат описващ, че резултатът от услугата все още не е готов и се обработва (IsReady e true, ServiceCallID и VerificationCode имат стойности и полето HasError няма стойност или е false). 
Тази операция реализира Poll механизъм за извличане на резултата. В случай, че при извикване на асинхронна услуга на адаптер, е посочен параметър CallbackURL извикването на тази операция не би трябвало да е необходимо. Асинхронните операции на адаптер ще бъдат ясно описани като такива. Към момента не съществуват продукицонно инсталирани асинхронни адаптери.

### Аргумент (ServiceCheckResultArgument)
|Име|Стойност|Описание|
|:-------|:-------|:--------|
|ServiceCallID|Number|Идентификатор на извикването в RegiX (получен като резултат при изпълнение на операцията Execute|
|VerificationCode|String|Код за потвърждение (получен като резултат при изпълнение на операцията Execute|

### Резултат (ServiceResultData)
Обектът е същия като описания в операцията Execute

## AcknowledgeResultReceived
Операцията служи за информиране на адаптер, че резултатът от изпълнението на асинхронна услуга е получен. Това позволява на адаптерите да освободят използваните ресурси (изготвеният резултат). Услугата изисква входен параметър идентичен с аргумента на операцията CheckResult и не очаква резултат.

### Аргумент (ServiceCheckResultArgument)
Обектът е същия като описания в операцията CheckResult

## ExecuteCallback
Операцията не се реализира от RegiXEntryPointV2.svc услугата. Тази операция трябва да бъде реализирана от система извършваща обръщения към асинхронни услуги на адаптер и очакваща Callback. Услугата посочена в полето CallbackURL на аргумента за операция Execute е необходимо да реализира тази операция.

### Аругемнт (ServiceResultData)
Съвпада с обекта връщан като резултат на операцията Execute. Очаква се обектът или да съдържа резултатът от изпълнениенот на поискана от заявяващата система асинхронна услуга, или информация за грешка при нейната обработка.
